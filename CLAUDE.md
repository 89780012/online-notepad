# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## å˜æ›´è®°å½• (Changelog)

### 2025-09-03 20:28:21
- **æ¶æ„å¸ˆåˆå§‹åŒ–å®Œæˆ**: è‡ªé€‚åº”æ‰«æç­–ç•¥è¦†ç›– 52/65 æ–‡ä»¶ (80%)
- **æ¨¡å—ç»“æ„å›¾ç”Ÿæˆ**: æ·»åŠ  Mermaid äº¤äº’å¼æ¶æ„å›¾
- **ç´¢å¼•ç³»ç»Ÿå»ºç«‹**: ç”Ÿæˆ `.claude/index.json` å®Œæ•´é¡¹ç›®ç´¢å¼•
- **è¦†ç›–ç‡æŠ¥å‘Š**: è¯†åˆ« 9 ä¸ªä¸»è¦æ¨¡å—ï¼Œå®Œæ•´æ‰«æ 7 ä¸ªæ ¸å¿ƒæ¨¡å—
- **æŠ€æœ¯å€ºåŠ¡è¯„ä¼°**: æ ‡è¯†å…³é”®ç¼ºå£ï¼ˆæµ‹è¯•ã€å®‰å…¨ã€æ€§èƒ½ä¼˜åŒ–ï¼‰

---

## é¡¹ç›®æ„¿æ™¯

Online Notepad æ—¨åœ¨æˆä¸ºæœ€ç®€æ´é«˜æ•ˆçš„åœ¨çº¿è®°äº‹æœ¬åº”ç”¨ï¼Œä¸“æ³¨äº Markdown ç¼–è¾‘ä½“éªŒã€å¤šè¯­è¨€æ”¯æŒå’Œæ— å¹²æ‰°çš„å†™ä½œç¯å¢ƒã€‚é‡‡ç”¨ç°ä»£ Web æŠ€æœ¯æ ˆï¼Œæä¾›æ¡Œé¢çº§ç¼–è¾‘ä½“éªŒçš„åŒæ—¶ä¿æŒè½»é‡å¿«é€Ÿã€‚

## æ¶æ„æ€»è§ˆ

### æŠ€æœ¯é€‰å‹å“²å­¦
- **ç°ä»£åŒ–ä¼˜å…ˆ**: Next.js 15 + React 19 å‰æ²¿ç‰ˆæœ¬
- **ç±»å‹å®‰å…¨**: TypeScript ä¸¥æ ¼æ¨¡å¼å…¨è¦†ç›–  
- **æ€§èƒ½ä¼˜å…ˆ**: Turbopack æ„å»º + ç»„ä»¶æ‡’åŠ è½½
- **ç”¨æˆ·ä½“éªŒ**: å“åº”å¼è®¾è®¡ + PWA å°±ç»ª
- **å›½é™…åŒ–**: next-intl å®Œæ•´ i18n è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Next.js 15.5.2 (App Router) + React 19.1.0
- **ç±»å‹ç³»ç»Ÿ**: TypeScript ä¸¥æ ¼æ¨¡å¼ + Zod è¿è¡Œæ—¶éªŒè¯
- **æ ·å¼æ–¹æ¡ˆ**: Tailwind CSS 4.0 + Radix UI + è‡ªå®šä¹‰è®¾è®¡ç³»ç»Ÿ
- **æ•°æ®æŒä¹…åŒ–**: PostgreSQL + Prisma ORM 6.15.0
- **å›½é™…åŒ–**: next-intl æ”¯æŒä¸­è‹±æ–‡è·¯ç”±
- **Markdown**: @uiw/react-md-editor + KaTeX æ•°å­¦å…¬å¼
- **çŠ¶æ€ç®¡ç†**: React Context + è‡ªå®šä¹‰ Hooks

### æ¨¡å—ç»“æ„å›¾

```mermaid
graph TD
    A["ğŸ  online-notepad<br/>æ ¹ç›®å½•"] --> B["ğŸ“± src/app<br/>Next.js è·¯ç”±å±‚"];
    A --> C["ğŸ¨ src/components<br/>React ç»„ä»¶åº“"];
    A --> D["ğŸ›  src/lib<br/>æ ¸å¿ƒå·¥å…·åº“"];
    A --> E["ğŸŒ src/i18n<br/>å›½é™…åŒ–æ¨¡å—"];
    A --> F["ğŸ£ src/hooks<br/>React Hooks"];
    A --> G["ğŸ—ƒ prisma<br/>æ•°æ®åº“æ¨¡å—"];
    A --> H["ğŸŒ public<br/>é™æ€èµ„æº"];

    B --> B1["[locale]/page.tsx<br/>ä¸»åº”ç”¨é¡µé¢"];
    B --> B2["api/notes/<br/>RESTful API"];
    B --> B3["middleware.ts<br/>å›½é™…åŒ–ä¸­é—´ä»¶"];

    C --> C1["NewMarkdownEditor.tsx<br/>ç¼–è¾‘å™¨æ ¸å¿ƒ"];
    C --> C2["NoteList.tsx<br/>ç¬”è®°åˆ—è¡¨"];
    C --> C3["ui/<br/>åŸºç¡€ç»„ä»¶"];

    D --> D1["prisma.ts<br/>æ•°æ®åº“å®¢æˆ·ç«¯"];
    D --> D2["utils.ts<br/>é€šç”¨å·¥å…·"];

    G --> G1["schema.prisma<br/>æ•°æ®æ¨¡å‹"];
    G --> G2["migrations/<br/>æ•°æ®åº“ç‰ˆæœ¬"];

    click B "./src/app/CLAUDE.md" "æŸ¥çœ‹ App Router æ¨¡å—æ–‡æ¡£"
    click C "./src/components/CLAUDE.md" "æŸ¥çœ‹ç»„ä»¶åº“æ¨¡å—æ–‡æ¡£"
    click D "./src/lib/CLAUDE.md" "æŸ¥çœ‹å·¥å…·åº“æ¨¡å—æ–‡æ¡£"
    click E "./src/i18n/CLAUDE.md" "æŸ¥çœ‹å›½é™…åŒ–æ¨¡å—æ–‡æ¡£"
    click F "./src/hooks/CLAUDE.md" "æŸ¥çœ‹ Hooks æ¨¡å—æ–‡æ¡£"
    click G "./prisma/CLAUDE.md" "æŸ¥çœ‹æ•°æ®åº“æ¨¡å—æ–‡æ¡£"
```

## æ¨¡å—ç´¢å¼•

| æ¨¡å— | è·¯å¾„ | ç±»å‹ | è´£ä»»æè¿° | å…¥å£æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|----------|----------|------|
| **App Router å±‚** | `src/app/` | Next.js è·¯ç”± | é¡µé¢è·¯ç”±ã€API ç«¯ç‚¹ã€ä¸­é—´ä»¶ | `[locale]/page.tsx` | âœ… å®Œæ•´ |
| **React ç»„ä»¶åº“** | `src/components/` | UI ç»„ä»¶ | ç¼–è¾‘å™¨ã€åˆ—è¡¨ã€å¯¹è¯æ¡†ã€å·¥å…·æ  | `NewMarkdownEditor.tsx` | âœ… å®Œæ•´ |
| **æ ¸å¿ƒå·¥å…·åº“** | `src/lib/` | å·¥å…·å‡½æ•° | æ•°æ®åº“è¿æ¥ã€é€šç”¨å·¥å…· | `prisma.ts` | âœ… å®Œæ•´ |
| **å›½é™…åŒ–æ¨¡å—** | `src/i18n/` | i18n é…ç½® | å¤šè¯­è¨€è·¯ç”±ã€æ¶ˆæ¯ç®¡ç† | `config.ts` | âœ… å®Œæ•´ |
| **React Hooks** | `src/hooks/` | è‡ªå®šä¹‰ Hook | æœ¬åœ°å­˜å‚¨ã€çŠ¶æ€ç®¡ç† | `useLocalNotes.ts` | âœ… å®Œæ•´ |
| **Context ç®¡ç†** | `src/contexts/` | React Context | ä¸»é¢˜çŠ¶æ€ã€å…¨å±€çŠ¶æ€ | `ThemeContext.tsx` | âœ… å®Œæ•´ |
| **ç±»å‹å®šä¹‰** | `src/types/` | TypeScript | æ¥å£ã€ç±»å‹ã€æ¨¡å¼é…ç½® | `note-modes.ts` | âœ… å®Œæ•´ |
| **æ•°æ®åº“æ¨¡å—** | `prisma/` | æ•°æ®åº“ ORM | æ¨¡å¼å®šä¹‰ã€è¿ç§»ç®¡ç† | `schema.prisma` | âœ… å®Œæ•´ |
| **é™æ€èµ„æº** | `public/` | é™æ€æ–‡ä»¶ | å›¾æ ‡ã€SEOã€PWA é…ç½® | - | âš ï¸ åŸºç¡€ |

## è¿è¡Œä¸å¼€å‘

### å¿«é€Ÿå¯åŠ¨
```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ pnpm æ¨èï¼‰
pnpm install

# 2. é…ç½®æ•°æ®åº“ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶è®¾ç½® DATABASE_URL

# 3. åˆå§‹åŒ–æ•°æ®åº“
npx prisma db push
npx prisma generate

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆTurbopack åŠ é€Ÿï¼‰
pnpm dev
```

### æ„å»ºä¸éƒ¨ç½²
```bash
# ç”Ÿäº§æ„å»º
pnpm build

# é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
pnpm start

# æ•°æ®åº“è¿ç§»ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npx prisma migrate deploy
```

### æ•°æ®åº“ç®¡ç†
```bash
# å¯è§†åŒ–æ•°æ®åº“ç®¡ç†
npx prisma studio

# é‡ç½®æ•°æ®åº“ï¼ˆå°å¿ƒï¼ï¼‰
npx prisma db push --force-reset

# ç”Ÿæˆæ–°è¿ç§»
npx prisma migrate dev --name <migration-name>
```

## æµ‹è¯•ç­–ç•¥

### å½“å‰çŠ¶æ€: âš ï¸ æµ‹è¯•è¦†ç›–ç‡ 0%

**æ€¥éœ€å»ºç«‹çš„æµ‹è¯•ä½“ç³»ï¼š**

#### å•å…ƒæµ‹è¯• (Jest + Testing Library)
- [ ] **æ ¸å¿ƒç»„ä»¶**: `NewMarkdownEditor`, `NoteList`, `ThemeProvider`
- [ ] **ä¸šåŠ¡é€»è¾‘**: `useLocalNotes` Hook, æ•°æ®è½¬æ¢å‡½æ•°
- [ ] **å·¥å…·å‡½æ•°**: `src/lib/utils.ts`, ç±»å‹éªŒè¯å‡½æ•°

#### é›†æˆæµ‹è¯•
- [ ] **API è·¯ç”±**: `/api/notes` CRUD æ“ä½œ
- [ ] **æ•°æ®åº“æ“ä½œ**: Prisma æ¨¡å‹æµ‹è¯•
- [ ] **å›½é™…åŒ–**: è·¯ç”±åˆ‡æ¢ã€æ–‡æœ¬ç¿»è¯‘

#### E2E æµ‹è¯• (Playwright)  
- [ ] **æ ¸å¿ƒæµç¨‹**: åˆ›å»ºç¬”è®° â†’ ç¼–è¾‘ â†’ ä¿å­˜ â†’ åˆ†äº«
- [ ] **ä¸“æ³¨æ¨¡å¼**: å…¨å±åˆ‡æ¢ã€ESC é€€å‡º
- [ ] **ä¸»é¢˜åˆ‡æ¢**: äº®è‰²/æš—é»‘/ç³»ç»Ÿæ¨¡å¼
- [ ] **å¤šè¯­è¨€**: ä¸­è‹±æ–‡åˆ‡æ¢æµç¨‹

## ç¼–ç è§„èŒƒ

### TypeScript è§„èŒƒ
- **ä¸¥æ ¼æ¨¡å¼**: å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- **æ˜¾å¼ç±»å‹**: å…¬å…± API å¿…é¡»æ˜¾å¼æ ‡æ³¨ç±»å‹
- **æ¥å£ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨ interface è€Œé type
- **æšä¸¾ä½¿ç”¨**: ä½¿ç”¨ const assertion è€Œéä¼ ç»Ÿ enum

### React ç»„ä»¶è§„èŒƒ
```typescript
// âœ… æ¨èçš„ç»„ä»¶ç»“æ„
interface ComponentProps {
  title: string;
  onSave?: () => void;
}

export default function Component({ title, onSave }: ComponentProps) {
  // çŠ¶æ€å’Œå‰¯ä½œç”¨
  const [content, setContent] = useState('');
  
  // äº‹ä»¶å¤„ç†
  const handleSave = useCallback(() => {
    onSave?.();
  }, [onSave]);

  // æ¸²æŸ“
  return <div>{title}</div>;
}
```

### CSS/Tailwind è§„èŒƒ
- **åŸå­åŒ–ä¼˜å…ˆ**: ä¼˜å…ˆä½¿ç”¨ Tailwind åŸå­ç±»
- **è¯­ä¹‰åŒ–ç»„åˆ**: å¤æ‚æ ·å¼æå–ä¸º `@apply` æŒ‡ä»¤
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ä¼˜å…ˆï¼Œæ¸è¿›å¢å¼º
- **æš—è‰²ä¸»é¢˜**: ä½¿ç”¨ `dark:` å‰ç¼€ï¼Œç¡®ä¿å¯¹æ¯”åº¦

### API è®¾è®¡è§„èŒƒ
```typescript
// âœ… RESTful API è®¾è®¡æ¨¡å¼
// GET    /api/notes         - è·å–ç¬”è®°åˆ—è¡¨
// POST   /api/notes         - åˆ›å»ºæ–°ç¬”è®°  
// PUT    /api/notes/[id]    - æ›´æ–°ç¬”è®°
// DELETE /api/notes/[id]    - åˆ é™¤ç¬”è®°
// GET    /api/notes/share/[token] - è·å–åˆ†äº«ç¬”è®°

// âœ… ç»Ÿä¸€å“åº”æ ¼å¼
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}
```

## AI ä½¿ç”¨æŒ‡å¼•

### Claude Code æœ€ä½³å®è·µ

**ä¼˜å…ˆçº§åŸåˆ™:**
1. **å®‰å…¨ç¬¬ä¸€**: ä»»ä½•æ¶‰åŠç”¨æˆ·æ•°æ®çš„æ›´æ”¹éƒ½éœ€è¦å®‰å…¨éªŒè¯
2. **ç±»å‹å®‰å…¨**: ä¿æŒ TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œä¸å…è®¸ any ç±»å‹
3. **æ€§èƒ½ä¼˜åŒ–**: è€ƒè™‘ç»„ä»¶æ¸²æŸ“æ€§èƒ½å’ŒåŒ…å¤§å°å½±å“  
4. **ç”¨æˆ·ä½“éªŒ**: ç¡®ä¿å›½é™…åŒ–æ”¯æŒå’Œå“åº”å¼è®¾è®¡
5. **ä»£ç è´¨é‡**: éµå¾ªç°æœ‰çš„æ¶æ„æ¨¡å¼å’Œå‘½åçº¦å®š

**å¼€å‘å·¥ä½œæµ:**
```bash
# 1. å¼€å‘å‰æ£€æŸ¥
pnpm lint                    # ä»£ç é£æ ¼æ£€æŸ¥
pnpm type-check             # ç±»å‹æ£€æŸ¥ï¼ˆéœ€æ·»åŠ ï¼‰
pnpm test                   # æµ‹è¯•è¿è¡Œï¼ˆéœ€æ·»åŠ ï¼‰

# 2. å¼€å‘è¿‡ç¨‹
pnpm dev                    # çƒ­é‡è½½å¼€å‘

# 3. æäº¤å‰æ£€æŸ¥  
pnpm build                  # æ„å»ºéªŒè¯
pnpm lint                   # æœ€ç»ˆæ£€æŸ¥
```

**å¸¸è§ä»»åŠ¡æŒ‡å¼•:**
- **æ·»åŠ æ–°ç»„ä»¶**: æ”¾å…¥ `src/components/` å¹¶æ›´æ–°ç›¸å…³çš„ TypeScript ç±»å‹
- **ä¿®æ”¹æ•°æ®åº“**: é€šè¿‡ Prisma schemaï¼Œç„¶åè¿è¡Œ `prisma db push`
- **æ·»åŠ å›½é™…åŒ–**: åŒæ—¶æ›´æ–° `en.json` å’Œ `zh.json` æ¶ˆæ¯æ–‡ä»¶
- **ä¿®æ”¹ API**: ç¡®ä¿ Zod éªŒè¯å’Œé”™è¯¯å¤„ç†å®Œæ•´
- **æ ·å¼è°ƒæ•´**: ä¼˜å…ˆä½¿ç”¨ Tailwindï¼Œä¿æŒæš—è‰²ä¸»é¢˜å…¼å®¹æ€§

## å˜æ›´è®°å½• (Changelog)

### v0.1.0 - åˆå§‹ç‰ˆæœ¬ç‰¹æ€§
- âœ… Next.js 15 + React 19 ç°ä»£åŒ–æŠ€æœ¯æ ˆ
- âœ… Markdown å®æ—¶ç¼–è¾‘ä¸é¢„è§ˆ
- âœ… ä¸“æ³¨æ¨¡å¼å…¨å±ç¼–è¾‘ä½“éªŒ
- âœ… ä¸­è‹±æ–‡å›½é™…åŒ–å®Œæ•´æ”¯æŒ
- âœ… ä¸»é¢˜ç³»ç»Ÿï¼ˆäº®è‰²/æš—é»‘/ç³»ç»Ÿè·Ÿéšï¼‰
- âœ… è‡ªå®šä¹‰åˆ†äº«é“¾æ¥åŠŸèƒ½
- âœ… æœ¬åœ°å­˜å‚¨ç¦»çº¿èƒ½åŠ›
- âœ… å“åº”å¼ç§»åŠ¨ç«¯é€‚é…
- âœ… PostgreSQL æ•°æ®æŒä¹…åŒ–

### å·²çŸ¥æŠ€æœ¯å€ºåŠ¡
#### ğŸ”´ å…³é”®é—®é¢˜
- **æµ‹è¯•è¦†ç›–ç‡**: 0% â†’ éœ€è¦å»ºç«‹å®Œæ•´æµ‹è¯•ä½“ç³»
- **XSS é˜²æŠ¤**: Markdown æ¸²æŸ“éœ€è¦å†…å®¹å‡€åŒ–
- **é”™è¯¯è¾¹ç•Œ**: ç¼ºå°‘ React Error Boundary ç»„ä»¶

#### ğŸŸ¡ æ”¹è¿›æœºä¼š  
- **æ€§èƒ½ä¼˜åŒ–**: ç»„ä»¶ä»£ç åˆ†å‰²ã€åŒ…å¤§å°ä¼˜åŒ–
- **å¯è®¿é—®æ€§**: é”®ç›˜å¯¼èˆªã€å±å¹•é˜…è¯»å™¨æ”¯æŒ
- **å¼€å‘å·¥å…·**: Prettierã€pre-commit hooksã€CI/CD

#### ğŸŸ¢ å¢å¼ºåŠŸèƒ½
- **ç¼–è¾‘æ¨¡å¼æ‰©å±•**: å¯Œæ–‡æœ¬ã€ä»£ç ã€ç»˜å›¾æ¨¡å¼
- **å¯¼å‡ºåŠŸèƒ½**: PDFã€Wordã€HTML æ ¼å¼
- **åä½œåŠŸèƒ½**: å®æ—¶å¤šäººç¼–è¾‘ã€è¯„è®ºç³»ç»Ÿ

---

> ğŸ“– **è¯¦ç»†æ¨¡å—æ–‡æ¡£**: å„æ¨¡å—çš„å…·ä½“å®ç°ç»†èŠ‚è¯·æŸ¥çœ‹å¯¹åº”çš„ `CLAUDE.md` æ–‡ä»¶
> 
> ğŸ”„ **æŒç»­æ›´æ–°**: æ­¤æ–‡æ¡£å°†éšé¡¹ç›®å‘å±•æŒç»­æ›´æ–°ï¼Œæ—¶é—´æˆ³è§é¡¶éƒ¨å˜æ›´è®°å½•